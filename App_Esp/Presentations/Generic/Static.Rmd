---
title: "Hacia la creación de una base de datos de investigación marina en México"
author: "Juliano Palacios Abrantes | Changing Oceans Research Unit, University of British Columbia"
date: "28/4/2017 | Centro de Investigación Científica y de Educación Superior de Ensenada, Baja California"
output: 
  ioslides_presentation: 
    logo: choru_logo.png
    widescreen: yes
    css: Untitled.css
---

```{r packages and data, eval=T, echo=F, warning=F, message=F}

library(data.table)
library(dygraphs)
library(knitr)
library(dplyr)
library(ggplot2)
library(wordcloud) #For Word Mining
#install.packages('tm')
library(tm) #For Word Mining

data<- fread("/Users/jpalacios/Documents/Github/Meta_Data_Mexico/App_Esp/Template.csv",
             colClasses = c(Location = 'character',
                            Notes = 'character')
)
K_data<- read.csv("./Data/GLosario.csv",
                  header = TRUE,
                  na="NA")

x <- fread("/Users/jpalacios/Documents/Github/Meta_Data_Mexico/App_Esp/Data_Curve.csv")
x <- x %>%
  select(-1)
```


## Introducción
<div class="columns-2">

<img src="Images/Flow.PNG" width=400 height=400>

- Aumento en la investigación multidisciplinaria

- Biología, Ecología, Oceanografía, Economía, etc

- ¿Falta de datos? o ¿falta de disponibilidad de datos?

- **Sin importar cuál sea, el resultado puede bloquear el progreso**

</div>

<div class="centered">
<div class="green2">

> - Una Base de metadatos fomenta la colaboración y apoya la toma de decisiones relevante a cualquier comunidad o región del país

</div>

## Objetivos del Proyecto

> - Diseñar la estructura de la base de metadatos de investigación relacionada con ecosistemas marinos y temas relacionados en México

<div class="green2">
> - **Identificar fuentes de datos disponibles e incorporar los metadatos de los mismos a la estructura**
</div>

> - Identificar tendencias en la disponibilidad de datos en México
> - Identificar información y vaciós de la misma que deberían ser tratados a futuro
> - Desarrollar protocolos para la publicación de la base de metadatos así como la incorporación de nuevos  registros

## Estructura de los Metadatos {.biger}

```{r Metadata display, eval=T, echo=F, warning=F,message=F}

 Title <- names(data)
kable(
  data.table(
  V1 = Title[1:7],
  V2 = Title[8:14],
  V3 = Title[15:21],
  V3 = Title[22:28]
),
col.names = NA
)

```

## Estado actual de la base

<div class="centered">

```{r Current Status, eval=T, echo=F, warning=F,message=F, fig.align="center"}

xx <- ts(x,
         start=c(2016,11),
         end = c(2017,4), # <- this has to be changed everytime we add a month
         frequency= 12)

dygraph(xx) %>% #Creats the graph
  dyOptions(stackedGraph = TRUE, #Makes it stacked
            drawPoints = TRUE, #Shows each data point
            pointSize = 4) %>%
  #dyRangeSelector(height = 20) %>%
  dyAxis("x", drawGrid = FALSE) %>% #Removes the grid
  dyAxis("y", drawGrid = FALSE) %>%
  dyAxis("y", label = "Número de Registros") %>%  #Labels
  dyLegend(width = 400)

## Solid numbers ####
# Number of entries ####
Number_entries <- data %>%
  filter(MMID != "na")
Number_entriess <- paste(Number_entries$MMID[length(Number_entries$MMID)])

# Number of Data Points ####
Number_dp <- paste(sum(Number_entries$Data_Time_Points,na.rm=T))

# Number of Repositories ####
z<- data %>%
  group_by(Compilation_Title) %>%
  summarise(sum(Data_Time_Points)) %>%
  select(-2) %>%
  filter(!is.na(Compilation_Title)) %>%
  mutate(z = 1)

zz <- paste(sum(z$z))

```

>- Desde noviembre se han colectado: **`r Number_entriess`** registros, de **`r zz`** repositorios que equivalen a **`r Number_dp`** datos de investigación marina en México

</div>

## Fuentes de Información

<div class="centered">

> - <img src="Images/Logos.PNG" width=750 height=300>

> - <img src="Images/Unete.jpg" width=570 height=250>

</div>

## Resultados preliminares {.smaller}

```{r Preeliminarya, eval=T, echo=F, warning=F,message=F, fig.width=9,fig.height=4.5, fig.align="center"}

Spp <- data %>% 
  filter(Area != "TBD") %>% 
  group_by(Area) %>% 
  summarise(Entradas = sum(Data_Time_Points,na.rm=T)) %>% 
  filter(Area !="na") # %>% 
# filter(Entradas >= input$Num_Data_Range[1]) %>% 
# filter(Entradas <= input$Num_Data_Range[2])

P1 <- ggplot(data= Spp,
       aes(
         x=reorder(Area, -Entradas),
         y=Entradas,
         fill=Area
       )) +
  geom_bar(stat="identity")+
  #coord_flip()+
  theme_classic() +
  ylab("Números de Datos")+
  xlab("Área")+
  theme(axis.text.x = element_text(hjust = 1,
                                   size=14,
                                   angle=45),
        axis.text.y = element_text(size = 14),
        legend.position = "none",
        axis.title = element_text(size=14,
                                  face="bold")
        
  )
Spp2 <- data %>%
  filter(Region != "TBD") %>% 
  group_by(Region) %>%
  summarise(Value = sum(Data_Time_Points,na.rm=T)) %>% 
  filter(Region != "na") %>% 
  filter(Region != "")

P2 <-ggplot(data= Spp2,
       aes(
         x=reorder(Region, -Value),
         y=Value,
         fill=Region
       )) +
  geom_bar(stat="identity")+
  theme_classic() +
  ylab("Número de Datos")+
  xlab("Región")+
  theme(axis.text.x = element_text(hjust = 1,
                                   size=14,
                                   angle = 45),
        axis.text.y = element_text(size = 14),
        legend.position = "none",
        axis.title = element_text(size=14,
                                  face="bold")
  )

gridExtra::grid.arrange(
  P1,
  P2,
  ncol = 2
)

```

***

### Palabras clave más frecuentes

```{r Preeliminaryb, eval=T, echo=F, warning=F,message=F, fig.align="center"}

Words <- data
WordsCorpus <- Corpus(VectorSource(Words$Keywords)) #Selects only Keywords
WordsCorpus <- tm_map(WordsCorpus,
                      PlainTextDocument) #Converts to plain text
WordsCorpus <- tm_map(WordsCorpus,
                      removePunctuation) #Removes punctuation

#Removes a word of user preference
# WordsCorpus <- tm_map(WordsCorpus,
#                       removeWords)
#

suppressWarnings(wordcloud(WordsCorpus, #Plots the words
                           max.words = 100,
                           random.order = FALSE,
                           colors=brewer.pal(8, "Dark2")
)
)

```


## Colaboración

<div class="centered">
<div class="green2">

**¡Cuantas más personas participen, mejor podremos reflejar el estado de la investigación marina en México!**

</div>
</div>

<div class="columns-2">

>- <img src="Images/Colabora.png" width=300 height=400>

>- **Informa:** Estamos buscando por cualquier fuente de datos relevante a los ecosistemas marinos en México.

>- **Difunde:** Parte del éxito de este proyecto depende de la cantidad de participantes involucrados y las distintas disciplinas que se logren reflejar

</div>

## ¡Gracias!

<div class="centered">

Juliano Palacios-Abrantes | j.palacios@oceans.ubc.ca

- **Colaboradores:**
Arreguín-Sánchez F, Cheung W. William, Cisneros-Mata Miguel A, Cisneros-Montemayor Andres, Rodriguez Laura

<img src="Images/Logos_PI.PNG" width=400 height=110>

Página del proyecto: https://jepa.shinyapps.io/marmetadatamexesp/

</div>

# ¿Preguntas?

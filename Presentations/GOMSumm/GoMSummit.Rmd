---
title: "Meta-database of Marine Research in Mexico"
subtitle: "State of The Gulf of Mexico Summit 2017"
author: "Juliano Palacios Abrantes | Changing Oceans Research Unit, University of British Columbia"
date: "14/3/2017 | Harte Research Institute, Texas A&M University"
output:

  ioslides_presentation: 
    keep_md: yes
runtime: shiny
logo: choru_logo.PNG
widescreen: TRUE
---

```{r packages and data, eval=T, echo=F, warning=F,message=F}


library(data.table)
library(networkD3)
library(dygraphs)
library(dplyr)
library(DT)
library(ggplot2)
library(wordcloud) #For Word Mining
#install.packages('tm')
library(tm) #For Word Mining

data<- fread("./Template.csv",
                 colClasses = c(Location = 'character',
                                Notes = 'character')
                 )
K_data<- read.csv("./Metadata_Key.csv",
                    header = TRUE,
                    na="NA")

```


## Project Backround
<div class="columns-2">

<img src="Images/FlowC.PNG" width=400 height=400>

- Increasingly depending on multidisciplinary research

- Biology, Ecology, Oceanography, Economy, etc!

- Lack of data or lack of data availability?

    - No matter which, the result can block progress

</div>

<div class="centered">
> - A meta-database fosters collaboration and eases the process of informing best policies relevant to any community or region
</div>
## Objectives

1.	Identify information and research gaps that should be addressed in the future
2.	Develop protocols for public sharing of the meta-database and inclusion of new information in the future

## Metadata Structure

```{r Metadata display, eval=T, echo=F, warning=F,message=F}
library(shiny)


ui <- fluidPage(
  tabsetPanel(
               id ="Data_Explorer",
                 tabPanel(
                   p("Metadata Key"),
                   dataTableOutput("Metadata_Key")
                 ),
                 tabPanel(
                   p("Metadata"),
                        dataTableOutput("datatable")
    )
  )
)


server <- function(input, output) {
output$Metadata_Key <- renderDataTable({


    datatable(K_data,
              rownames = FALSE,
              filter = 'top',
              escape = FALSE,
              options = list(pageLength = 50,
                             autoWidth = TRUE
                             )
              )

  })

   output$datatable <- renderDataTable({

     datatable(data,
              rownames = FALSE,
              filter = 'top',
              escape = FALSE,
              options = list(pageLength = 28,
                             autoWidth = TRUE,
                             lengthMenu = c(10, 20,30)
                             )
)
   })
}

# Run the application
shinyApp(ui = ui, server = server)

```

## Current Status of the Metadata

<div class="centered">

```{r Current Status, eval=T, echo=F, warning=F,message=F, fig.align="center"}

x <- fread("./Data_Curve.csv")
x <- x %>%
  select(-1)

xx <- ts(x,
                  start=c(2016,11),
                  end = c(2017,3), # <- this has to be changed everytime we add a month
                  frequency= 12)

dygraph(xx) %>% #Creats the graph
    dyOptions(stackedGraph = TRUE, #Makes it stacked
              drawPoints = TRUE, #Shows each data point
              pointSize = 4) %>%
    dyRangeSelector(height = 20) %>%
    dyAxis("x", drawGrid = FALSE) %>% #Removes the grid
    dyAxis("y", drawGrid = FALSE) %>%
    dyAxis("y", label = "Number of Data Points") %>%  #Labels
    dyLegend(width = 600)

  ## Solid numbers ####
  # Number of entries ####
    Number_entries <- data %>%
      filter(MMID != "na")
    Number_entriess <- paste(Number_entries$MMID[length(Number_entries$MMID)])

  # Number of Data Points ####
    Number_dp <- paste(sum(Number_entries$Data_Time_Points,na.rm=T))

  # Number of Repositories ####
     z<- data %>%
      group_by(Compilation_Title) %>%
      summarise(sum(Data_Time_Points)) %>%
      select(-2) %>%
      filter(!is.na(Compilation_Title)) %>%
      mutate(z = 1)

    zz <- paste(sum(z$z))

```


>- Since November we have colected: **`r Number_entriess`** Records, from **`r zz`** repositories, resulting in **`r Number_dp`** data points

</div>

## Preliminar Results for the Gulf of Mexico {.smaller}

```{r Current Statusb, eval=T, echo=F, warning=F,message=F}

## Solid numbers ####
  # Number of entries ####
G_Number_entries <- data %>%
  filter(MMID != "na") %>%
  filter(Area =="Atlantic")

G_Number_entriess <- paste(G_Number_entries$MMID[length(G_Number_entries$MMID)])
#
#   # Number of Data Points ####
    G_Number_dp <- paste(sum(G_Number_entries$Data_Time_Points,na.rm=T))

  # Number of Repositories ####
     G_z<- data %>%
      filter(Area =="Atlantic") %>%
      group_by(Compilation_Title) %>%
      summarise(sum(Data_Time_Points)) %>%
      select(-2) %>%
      filter(!is.na(Compilation_Title)) %>%
      mutate(z = 1)

    G_zz <- paste(sum(G_z$z))

#     #### Repositories ####
# Inst_Table <- data %>%
#       filter(Area =="Atlantic") %>%
#      group_by(Institution,
#               Compilation_Title) %>%
#      summarise(x = n()) %>%
#      filter(Institution != "na",
#             Institution != "Varios") %>%
#      select(Institution,
#             Compilation_Title)
#    colnames(Inst_Table) <- c("Institution","Repository")
#
#
# Repositories <- datatable(Inst_Table,
#               rownames = FALSE,
#               escape = FALSE,
#               options = list(dom="t"
#               )
#     )


```

<div class="centered">

> The Metadata has **`r G_Number_entriess`** Records, from **`r G_zz`** repositories, resulting in **`r G_Number_dp`** data points

### **Institutions Collaborating**

<img src="Images/Logos2.PNG" width=750 height=300>

> - <img src="Images/Gom.PNG" width=570 height=80>

</div>

## Preliminar Results for the Gulf of Mexico (cont.)

<div class="columns-2">

```{r Preeliminary, eval=T, echo=F, warning=F,message=F, fig.width=5.5,fig.height=4.5, fig.align="center"}

Se_Plot <- data %>%
  filter(Area == "Atlantic") %>%
          filter(!is.na(Region)) %>%
          group_by(Research_Field,Region) %>%
          summarise(Entradas = sum(Data_Time_Points,na.rm=T))

        ggplot(data=Se_Plot,
               aes(
                 x=Region,
                 y= Entradas,
                 fill= Research_Field
               ))+
          geom_bar(stat = "identity")+
          theme_classic() +
          ylab("Number of Data Points")+
          theme(axis.text.x = element_text(
                                           size=12),
                axis.text.y = element_text(size = 12),
                legend.position = "bottom",
                axis.title = element_text(size=12,
                                          face="bold"))+
          guides(fill = guide_legend(title = "Research Field",
                                     title.position = "top"),
                 col = guide_legend(nrow = 3))+
          scale_x_discrete("Region", labels = c("Campeche B \n Caribe","West G.\n Mexico"))

```


```{r Preeliminaryb, eval=T, echo=F, warning=F,message=F, fig.align="center"}


    Words <- data %>%
  filter(Area=="Atlantic")
    WordsCorpus <- Corpus(VectorSource(Words$Keywords)) #Selects only Keywords
    WordsCorpus <- tm_map(WordsCorpus,
                          PlainTextDocument) #Converts to plain text
    WordsCorpus <- tm_map(WordsCorpus,
                          removePunctuation) #Removes punctuation

    #Removes a word of user preference
    # WordsCorpus <- tm_map(WordsCorpus,
    #                       removeWords)
    #

    suppressWarnings(wordcloud(WordsCorpus, #Plots the words
              max.words = 100,
              random.order = FALSE,
              colors=brewer.pal(8, "Dark2")
              )
    )

```

</div>


## Direct Collaboration

<div class="centered">
<div class="green2">

**The more people involved, the better we can reflect the state of marine research in Mexico!**

</div>
</div>

>- **Share:** Remember that we are looking for data information and not the data itself!

>- **Inform** We are looking for any source of information relevant to marine research in Mexico.

>- **Communicate** A large multidisciplinary group of collaborators will certainly contribute to a successful project

## Thank you !

<div class="centered">

Juliano Palacios-Abrantes | j.palacios@oceans.ubc.ca

- **Collaborators:**
Arreguín-Sánchez F, Cheung W. William, Cisneros-Mata Miguel A, Cisneros-Montemayor Andres, Rodriguez Laura

<img src="Images/Logos_PI.PNG" width=700 height=110>

</div>

# Questions?